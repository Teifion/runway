<div metal:use-macro="layout">
  <div metal:fill-slot="top_left" metal:define-slot="top_left">
    <a class="navbar-brand" href="${request.route_url('/')}">Breadcrumb</a>
  </div>
  
  <div metal:fill-slot="side_links_sm">
    <span tal:condition="'developer' in request.user.permissions()">
      <a href="${request.route_url('dev.home')}">
        Developer
      </a>
      &nbsp;&nbsp;&nbsp;
    </span>
    
    <span tal:condition="'admin' in request.user.permissions()">
      <a href="${request.route_url('admin.home')}">
        Admin
      </a>
      &nbsp;&nbsp;&nbsp;
    </span>
    
    <span tal:repeat="tm request.render['top_menu']">
      <a href="${request.route_url(tm['route'])}">${tm['text']}</a>
      &nbsp;&nbsp;&nbsp;
    </span>
  </div>
  
  <ul class="nav navbar-top-links navbar-right hidden-sm hidden-xs" metal:fill-slot="top_links" style="margin-right:0;">
    <li class="dropdown" tal:condition="getattr(request, 'messages', []) != []">
      <a class="dropdown-toggle" data-toggle="dropdown" href="#">
        <i class="fa fa-envelope fa-fw"></i>  <i class="fa fa-caret-down"></i>
      </a>
      <ul class="dropdown-menu dropdown-messages">
        <li tal:repeat="(href, title, subtitle, content) request.messages" class="pad">
          <a href="${href}">
            <div>
              <strong>${title}</strong>
              <span class="pull-right text-muted">
                <em>${subtitle}</em>
              </span>
            </div>
            <div>${content}</div>
          </a>
        </li>
      </ul>
        <!-- /.dropdown-messages -->
    </li>
    <!-- /.dropdown -->
    
    <li class="dropdown" tal:condition="getattr(request, 'tasks', []) != []">
      <a class="dropdown-toggle" data-toggle="dropdown" href="#">
        <i class="fa fa-tasks fa-fw"></i>  <i class="fa fa-caret-down"></i>
      </a>
      <ul class="dropdown-menu dropdown-tasks">
        <li tal:repeat="(href, name, completion, colour) request.tasks" class="pad">
          <a href="${href}">
            <div>
              <p>
                <strong>${name}</strong>
                <span class="pull-right text-muted">${completion}% Complete</span>
              </p>
              <div class="progress progress-striped active">
                <div class="progress-bar progress-bar-${colour}" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: ${completion}%">
                  <span class="sr-only">${completion}% Complete (success)</span>
                </div>
              </div>
            </div>
          </a>
        </li>
      </ul>
      <!-- /.dropdown-tasks -->
    </li>
    <!-- /.dropdown -->
    
    
    <li class="dropdown" tal:condition="request._documentation != [] or request.is_documentation">
      <a class="dropdown-toggle" data-toggle="dropdown" href="#">
          <i class="fa fa-book fa-fw fa-lg"></i>  <i class="fa fa-caret-down"></i>
      </a>
      <ul class="dropdown-menu dropdown-tasks">
        <li class="pad" tal:condition="False">
          <div>
            <p style="text-align: center; font-size: 1.1em;">
              Documentation related to this page
            </p>
          </div>
        </li>
        <li tal:repeat="d request.get_docs()" class="pad">
          <a href="${request.route_url(d.route)}">
            <div>
              <p>
                <div style="float: right;">
                  <i tal:repeat="i d.icons" class="fa fa-2x fa-${i} fa-fw text-${d.icon_colour}"></i>
                </div>
                
                <strong>${d.title}</strong>
              </p>
              <p>
                ${d.brief}
              </p>
            </div>
          </a>
        </li>
        
        <li class="pad">&nbsp;</li>
        <li class="pad">
          <a href="${request.route_url('documentation.home')}">
            <div>
              <p>
                <div style="float: right;">
                  <i class="fa fa-2x fa-book fa-fw text-default"></i>
                </div>
                
                <strong>Documentation home</strong>
              </p>
              <p>
                Central location of documentation in the application.
              </p>
            </div>
          </a>
        </li>
      </ul>
      <!-- /.dropdown-documentation -->
    </li>
    <!-- /.dropdown -->
    
    
    <li class="dropdown" tal:condition="getattr(request, 'alerts', []) != []">
      <a class="dropdown-toggle" data-toggle="dropdown" href="#">
        <i class="fa fa-bell fa-fw"></i>  <i class="fa fa-caret-down"></i>
      </a>
      <ul class="dropdown-menu dropdown-alerts">
        <li tal:repeat="(href, glyph, maintext, subtext) request.alerts" class="pad">
          <a href="${href}">
            <div>
              <i class="fa fa-${glyph} fa-fw"></i> ${maintext}
              <span class="pull-right text-muted small">${subtext}</span>
            </div>
          </a>
        </li>
      </ul>
      <!-- /.dropdown-alerts -->
    </li>
    
    <li class="dropdown" tal:condition="getattr(request, 'alerts', []) != []">
      <a class="dropdown-toggle" data-toggle="dropdown" href="#">
        <i class="fa fa-bell fa-fw"></i>  <i class="fa fa-caret-down"></i>
      </a>
      <ul class="dropdown-menu dropdown-alerts">
        <li tal:repeat="(href, glyph, maintext, subtext) request.alerts" class="pad">
          <a href="${href}">
            <div>
              <i class="fa fa-${glyph} fa-fw"></i> ${maintext}
              <span class="pull-right text-muted small">${subtext}</span>
            </div>
          </a>
        </li>
      </ul>
      <!-- /.dropdown-alerts -->
    </li>
    
    <!-- /.dropdown -->
    <li class="dropdown">
      <a class="dropdown-toggle" data-toggle="dropdown" href="#">
        <i class="fa fa-user fa-fw fa-lg"></i>  <i class="fa fa-caret-down"></i>
      </a>
      <ul class="dropdown-menu dropdown-user">
        <li tal:repeat="(href, glyph, text) request.user_links" tal:condition="getattr(request, 'user_links', []) != []">
          <a href="${href}"><i class="fa fa-${glyph} fa-fw"></i> ${text}</a>
        </li>
        <li tal:condition="False">
          <a href="#" onclick="toggle_sidebar(); return false;"><i class="fa fa-gear fa-fw"></i> Expand/Collapse sidebar</a>
        </li>
        <li>
          <a href="${request.route_url('user.control_panel')}"><i class="fa fa-gear fa-fw"></i> Settings</a>
        </li>
        <li class="divider"></li>
        
        <li tal:condition="request.runway_settings.users['allow_cron'] == 'True' or 'cron' in request.user.permissions()">
          <a href="${request.route_url('cron.user.control_panel')}"><i class="fa fa-clock-o fa-fw"></i> Cron jobs</a>
        </li>
        <li tal:condition="request.runway_settings.users['allow_widgets'] == 'True' or 'widgets' in request.user.permissions()">
          <a href="${request.route_url('widgets.user.control_panel')}"><i class="fa fa-tachometer fa-fw"></i> Widgets</a>
        </li>
        <li tal:condition="request.runway_settings.users['allow_triggers'] == 'True' or 'triggers' in request.user.permissions()">
          <a href="${request.route_url('triggers.user.control_panel')}"><i class="fa fa-link fa-fw"></i> Triggers</a>
        </li>
        
        <li tal:condition="request.runway_settings.users['allow_groups'] == 'True'">
          <a href="${request.route_url('user.groups.list')}"><i class="fa fa-users fa-fw"></i> Groups</a>
        </li>
        
        <li class="divider"></li>
        
        <li><a href="${request.route_url('core.logout')}" tal:condition="hasattr(request, 'user')"><i class="fa fa-sign-out fa-fw"></i> Logout ${request.user.username}</a>
        </li>
      </ul>
      <!-- /.dropdown-user -->
    </li>
  </ul>

  <nav class="navbar-default navbar-static-side" role="navigation" metal:fill-slot="side_links" metal:define-slot="side_links">
    <div class="sidebar-collapse" tal:condition="not hasattr(request, 'user')">
      <ul class="nav" id="side-menu">
        <li id="sidebar_login">
          <a href="${request.route_url('core.login')}"><i class="fa fa-male fa-fw"></i> Login</a>
        </li>
      </ul>
    </div>
    
    <div class="sidebar-collapse" tal:condition="hasattr(request, 'user')">
      <ul class="nav" id="side-menu">
        <li class="sidebar-logo">
          <div metal:define-slot="sidebar_logo">Sidebar logo</div>
        </li>
        
        <li class="sidebar-search" tal:condition="False">
          <div class="input-group custom-search-form">
            <input type="text" class="form-control" placeholder="Search...">
            <span class="input-group-btn">
              <button class="btn btn-default" type="button">
                <i class="fa fa-search"></i>
              </button>
            </span>
          </div>
          <!-- /input-group -->
        </li>
        
        <li id="sidebar_home">
          <a href="${request.route_url('/')}">
            <i class="fa fa-home fa-fw fa-lg"></i>
            &nbsp;
            Home
          </a>
        </li>
        <li tal:condition="'developer' in request.user.permissions()" id="sidebar_developer">
          <a href="${request.route_url('dev.home')}">
            <i class="fa fa-power-off fa-fw fa-lg"></i>
            &nbsp;
            Developer
          </a>
        </li>
        <li tal:condition="'admin' in request.user.permissions()" id="sidebar_admin">
          <a href="${request.route_url('admin.home')}">
            <i class="fa fa-group fa-fw fa-lg"></i>
            &nbsp;
            Admin
          </a>
        </li>
        
        <li>&nbsp;</li>
        
        <!-- Module entries -->
        <li id="${sm['id']}" tal:repeat="sm request.render['side_menu']">
          <a href="${request.route_url(sm['route'])}" id="sidebar_${sm['id']}">
            <i class="fa fa-fw ${sm['icon']} fa-lg"></i>
            &nbsp;
            ${sm['text']}
          </a>
        </li>
        
      </ul>
      
      <div id="append_side_content" style="display:none;" metal:define-slot="append_side_content">
          
      </div>
      <div id="prepend_side_content" style="display:none;" metal:define-slot="prepend_side_content">
          
      </div>
      <script>
        $(function() {
          $('#sidebar_home').before($('#prepend_side_content').contents());
          $('#side-menu').append($('#append_side_content').contents());
        });
      </script>
      <!-- /#side-menu -->
    </div>
  </nav>
  
</div>